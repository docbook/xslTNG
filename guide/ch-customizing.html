<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" class="no-js"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script><title>Chapter 3. Customizing the stylesheets</title><link href="./css/pygments.css" rel="stylesheet"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link href="https://purl.org/dc/elements/1.1/" rel="schema.dc"/><meta name="dc.modified" content="2023-01-06T09:52:19Z"/><meta name="dc.created" content="2023-01-06T09:52:19Z"/><meta name="generator" content="DocBook xslTNG version 2.0.2-SNAPSHOT / 5743542 / SAXON HE 11.4"/><link href="./css/guide-toc.css" rel="stylesheet"/><link href="./css/docbook.css" rel="stylesheet" media="screen"/><link href="./css/docbook-paged.css" rel="stylesheet" media="print"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link href="css/guide.css" rel="stylesheet"/><link href="css/guide-online.css" rel="stylesheet"/><link href="media/xsltng-icon.png" rel="shortcut icon"/><script src="https://kit.fontawesome.com/c94d537c36.js" type="text/javascript" crossorigin="anonymous"></script><link rel="prev" href="ch-using.html"/><link rel="next" href="ch-localization.html"/><link rel="up" href="parti.html"/><link rel="home" href="index.html"/></head><body><nav class="top"><span class="nav"><a title="DocBook xslTNG Reference" href="index.html"><i class="fas fa-home"></i></a> <a href="ch-using.html" title="Chapter  2 .  Using the stylesheets"><i class="fas fa-arrow-left"></i></a> <a title="Part  I .  Introduction" href="parti.html"><i class="fas fa-arrow-up"></i></a> <a title="Chapter  4 .  Localization" href="ch-localization.html"><i class="fas fa-arrow-right"></i></a></span><span class="title"><i class="title">DocBook xslTNG Reference</i></span><span class="logo"><img src="media/xsltng-inverted.png"/></span></nav><main><div id="customization" class="chapter component"><header><h1>Chapter <span class="label">3</span><span class="sep">. </span>Customizing the stylesheets</h1></header><p>In many circumstances, the stylesheets can be used “out of the
box” without any customization. But sometimes you may need to change
the formatting of certain elements. One common reason is to change the
formatting of title pages or navigational features. In other cases, it
may be to support local extensions to DocBook or simply to change the
markup to support a particular use case.</p><p>Three approaches are possible, with increasing degrees of
effort: changing stylesheet parameters, creating your own
customization layer, or making broader changes to the stylesheet’s
implementation.</p><p>The subject of broader implementation changes is the subject of
<a href="ch-implementation.html" class="xref xref-chapter">Chapter <span class="label">5</span>, Implementation details</a>. In this chapter, we’ll look at the
easier options.</p><section id="change-params" class="section"><header><h2><span class="label">3<span class="sep">.</span>1</span><span class="sep">. </span>Changing stylesheet parameters</h2></header><p>The <i class="citetitle">DocBook xslTNG Stylesheets</i> define a
lot of parameters. They are all described in <a href="params.html" class="xref xref-reference"><span class="label">I</span><span class="sep">. </span>Parameter reference</a>.
If the change you want to make has already been parameterized, you may
be able to achieve your goal simply by setting a parameter at runtime.</p><p>For example, if you want to change the formatting of dates and times
in <code class="tag tag-element">date</code> elements, you can simply change the
<a href="p_date-date-format.html" class="link">date and time formatting</a>
parameters. Similarly, if you want to change the numeration style of
ordered lists, you can simply change the <a href="p_orderedlist-item-numeration.html" class="link">ordered list item
numeration</a> parameter.</p><p>These changes can be accomplished by simply passing the new
values to the processor, on the command line or in a configuration
file, for example. You do not have to write any XSLT to make these
changes.</p><p>Parameter values apply to the entire document processed by the
stylesheets. In some cases, you may wish to change the presentation of
just one or small number of elements. This can often be accomplished
with a <a href="pi_db.html" class="link">db processing instruction</a> in
the source document itself. These customizations can also be
accomplished without writing any XSLT.</p><p>If you want to make a change that isn’t supported by a
parameter, or an ad hoc exception that doesn’t have a supporting
processing instruction, you will have to write a customization layer.
(You are invited to submit an issue with your use case if you think it
would be of general interest.)
</p><p>You may also find it convenient to write a customization layer
if you want to change several parameters and you find it inconvenient
to pass them all to the processor on every invocation.
</p></section><section id="layer" class="section"><header><h2><span class="label">3<span class="sep">.</span>2</span><span class="sep">. </span>Creating a customization layer</h2></header><p>A customization layer is simply an XSLT stylesheet that you
write which extends the DocBook stylesheets. The simplest<sup id="layer_para1_footnote1-fref" db-footnote="2" class="footnote-number"><a href="#layer_para1_footnote1-fnote">*</a></sup> customization
layer is:</p><div class="pre-wrap highlight" db-startinglinenumber="1" db-numberoflines="14"><pre class="language-xml long numbered programlisting verbatim verblines"><span class="line" db-line="1"><span class="ln"> 1 <span class="nsep">|</span></span><span class="ld"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></code></span></span>
<span class="line" db-line="2"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;xsl:stylesheet</span></code></span></span>
<span class="line" db-line="3"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="na">xmlns:xsl=</span><span class="s">"http://www.w3.org/1999/XSL/Transform"</span></code></span></span>
<span class="line" db-line="4"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="na">xmlns:db=</span><span class="s">"http://docbook.org/ns/docbook"</span></code></span></span>
<span class="line" db-line="5"><span class="ln"> 5 <span class="nsep">|</span></span><span class="ld"><code>    <span class="na">xmlns:xs=</span><span class="s">"http://www.w3.org/2001/XMLSchema"</span></code></span></span>
<span class="line" db-line="6"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="na">xmlns=</span><span class="s">"http://www.w3.org/1999/xhtml"</span></code></span></span>
<span class="line" db-line="7"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="na">exclude-result-prefixes=</span><span class="s">"db xs"</span></code></span></span>
<span class="line" db-line="8"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="na">version=</span><span class="s">"3.0"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="9"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="10"><span class="ln">10 <span class="nsep">|</span></span><span class="ld"><code><span class="c">&lt;!-- This href has to point to your local copy</span></code></span></span>
<span class="line" db-line="11"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="c">     of the stylesheets. --&gt;</span></code></span></span>
<span class="line" db-line="12"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;xsl:import</span> <span class="na">href=</span><span class="s">"docbook/xslt/docbook.xsl"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line" db-line="13"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="14"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;/xsl:stylesheet&gt;</span></code></span></span>
</pre></div><p>This customization doesn’t do anything. But you can, for example, redefine
parameters if you wish:</p><div class="pre-wrap highlight" db-startinglinenumber="1" db-numberoflines="19"><pre class="language-xml long numbered programlisting verbatim verblines"><span class="line" db-line="1"><span class="ln"> 1 <span class="nsep">|</span></span><span class="ld"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></code></span></span>
<span class="line" db-line="2"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;xsl:stylesheet</span></code></span></span>
<span class="line" db-line="3"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="na">xmlns:xsl=</span><span class="s">"http://www.w3.org/1999/XSL/Transform"</span></code></span></span>
<span class="line" db-line="4"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="na">xmlns:db=</span><span class="s">"http://docbook.org/ns/docbook"</span></code></span></span>
<span class="line" db-line="5"><span class="ln"> 5 <span class="nsep">|</span></span><span class="ld"><code>    <span class="na">xmlns:xs=</span><span class="s">"http://www.w3.org/2001/XMLSchema"</span></code></span></span>
<span class="line" db-line="6"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="na">xmlns=</span><span class="s">"http://www.w3.org/1999/xhtml"</span></code></span></span>
<span class="line" db-line="7"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="na">exclude-result-prefixes=</span><span class="s">"db xs"</span></code></span></span>
<span class="line" db-line="8"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="na">version=</span><span class="s">"3.0"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="9"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="10"><span class="ln">10 <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;xsl:import</span> <span class="na">href=</span><span class="s">"docbook/xslt/docbook.xsl"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line" db-line="11"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="12"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;xsl:param</span> <span class="na">name=</span><span class="s">"orderedlist-item-numeration"</span></code></span></span>
<span class="line" db-line="13"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>           <span class="na">select=</span><span class="s">"'1'"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line" db-line="14"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="15"><span class="ln">15 <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;xsl:param</span> <span class="na">name=</span><span class="s">"date-dateTime-format"</span></code></span></span>
<span class="line" db-line="16"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>           <span class="na">select=</span><span class="s">"'[D01] [MNn,*-3] [Y0001]</span></code></span></span>
<span class="line" db-line="17"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="s">                   at [H01]:[m01]'"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line" db-line="18"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="19"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;/xsl:stylesheet&gt;</span></code></span></span>
</pre></div><p>This will have the effect of running the DocBook stylesheets with those two
parameters set as specified.</p><p>If you want to change the HTML output for an element, you can write a template
for that element in your customization layer. Consider this DocBook document:
</p><div class="pre-wrap highlight" db-startinglinenumber="1" db-numberoflines="12"><pre class="language-xml long numbered programlisting verbatim verblines"><span class="line" db-line="1"><span class="ln"> 1 <span class="nsep">|</span></span><span class="ld"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></code></span></span>
<span class="line" db-line="2"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;article</span> <span class="na">xmlns=</span><span class="s">"http://docbook.org/ns/docbook"</span></code></span></span>
<span class="line" db-line="3"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>         <span class="na">version=</span><span class="s">"5.1"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="4"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;info&gt;</span></code></span></span>
<span class="line" db-line="5"><span class="ln"> 5 <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;title&gt;</span>Sample Document<span class="nt">&lt;/title&gt;</span></code></span></span>
<span class="line" db-line="6"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;date&gt;</span>2020-07-05<span class="nt">&lt;/date&gt;</span></code></span></span>
<span class="line" db-line="7"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;/info&gt;</span></code></span></span>
<span class="line" db-line="8"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="9"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;para&gt;</span>This is a sample <span class="nt">&lt;productname&gt;</span>DocBook<span class="nt">&lt;/productname&gt;</span></code></span></span>
<span class="line" db-line="10"><span class="ln">10 <span class="nsep">|</span></span><span class="ld"><code>document.<span class="nt">&lt;/para&gt;</span></code></span></span>
<span class="line" db-line="11"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="12"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;/article&gt;</span></code></span></span>
</pre></div><p>Suppose that you decided you wanted to have the
<code class="tag tag-element">productname</code> element link automatically to the vendor
webpage.</p><div class="admonition important"><div><div class="icon">☝</div><div class="body"><header><div class="title">Important</div></header><div><p>The <i class="citetitle">DocBook xslTNG Stylesheets</i> process
<em>all</em> DocBook elements in the
<a href="m_docbook.html"><code class="mode">m:docbook</code></a> mode. This is different from previous XSLT stylesheets for DocBook
which simply used the default mode.</p><p>You must either specify a default mode in your customization layer
or remember to specify the mode on match templates and template applications.
If you forget the mode, you’ll get unexpected results!</p></div></div></div></div><p>One way to do that would be to redefine the template that processes the
<code class="tag tag-element">productname</code> element:</p><div class="programlistingco"><div class="pre-wrap highlight" db-startinglinenumber="1" db-numberoflines="54"><pre class="language-xml long numbered programlisting verbatim verblines"><span class="line" db-line="1"><span class="ln"> 1 <span class="nsep">|</span></span><span class="ld"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></code></span></span>
<span class="line" db-line="2"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;xsl:stylesheet</span></code></span></span>
<span class="line" db-line="3"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="na">xmlns:xsl=</span><span class="s">"http://www.w3.org/1999/XSL/Transform"</span></code></span></span>
<span class="line" db-line="4"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="na">xmlns:db=</span><span class="s">"http://docbook.org/ns/docbook"</span></code></span></span>
<span class="line" db-line="5"><span class="ln"> 5 <span class="nsep">|</span></span><span class="ld"><code>    <span class="na">xmlns:m=</span><span class="s">"http://docbook.org/ns/docbook/modes"</span>  <a id="ex.xmlns-m" class="callout-bug linecolumn" db-line="5" db-column="52">①</a></code></span></span>
<span class="line" db-line="6"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="na">xmlns:xs=</span><span class="s">"http://www.w3.org/2001/XMLSchema"</span></code></span></span>
<span class="line" db-line="7"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="na">xmlns=</span><span class="s">"http://www.w3.org/1999/xhtml"</span></code></span></span>
<span class="line" db-line="8"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="na">exclude-result-prefixes=</span><span class="s">"db m xs"</span>  <a id="ex.excl-m" class="callout-bug linecolumn" db-line="8" db-column="40">②</a></code></span></span>
<span class="line" db-line="9"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="na">version=</span><span class="s">"3.0"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="10"><span class="ln">10 <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="11"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;xsl:import</span> <span class="na">href=</span><span class="s">"docbook/xslt/docbook.xsl"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line" db-line="12"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="13"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;xsl:param</span> <span class="na">name=</span><span class="s">"orderedlist-item-numeration"</span></code></span></span>
<span class="line" db-line="14"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>           <span class="na">select=</span><span class="s">"'1'"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line" db-line="15"><span class="ln">15 <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="16"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;xsl:param</span> <span class="na">name=</span><span class="s">"date-dateTime-format"</span></code></span></span>
<span class="line" db-line="17"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>           <span class="na">select=</span><span class="s">"'[D01] [MNn,*-3] [Y0001]</span></code></span></span>
<span class="line" db-line="18"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="s">                   at [H01]:[m01]'"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line" db-line="19"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="20"><span class="ln">20 <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;xsl:template</span> <span class="na">match=</span><span class="s">"db:productname"</span></code></span></span>
<span class="line" db-line="21"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>              <span class="na">mode=</span><span class="s">"m:docbook"</span><span class="nt">&gt;</span>  <a id="ex.m-docbook" class="callout-bug linecolumn" db-line="21" db-column="34">③</a></code></span></span>
<span class="line" db-line="22"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;xsl:variable</span> <span class="na">name=</span><span class="s">"name"</span></code></span></span>
<span class="line" db-line="23"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>                <span class="na">select=</span><span class="s">"normalize-space(.)"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line" db-line="24"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><a id="ex.cramped" class="callout-bug linecolumn" db-line="24" db-column="1">④</a></code></span></span>
<span class="line" db-line="25"><span class="ln">25 <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;xsl:variable</span> <span class="na">name=</span><span class="s">"url"</span> <span class="na">as=</span><span class="s">"xs:string?"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="26"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="nt">&lt;xsl:choose&gt;</span></code></span></span>
<span class="line" db-line="27"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      <span class="nt">&lt;xsl:when</span> <span class="na">test=</span><span class="s">"$name='DocBook'"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="28"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>        <span class="nt">&lt;xsl:sequence</span> <span class="na">select=</span><span class="s">"'https://docbook.org/'"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line" db-line="29"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      <span class="nt">&lt;/xsl:when&gt;</span></code></span></span>
<span class="line" db-line="30"><span class="ln">30 <span class="nsep">|</span></span><span class="ld"><code>      <span class="nt">&lt;xsl:when</span> <span class="na">test=</span><span class="s">"$name='DocBook xslTNG Stylesheets'"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="31"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>        <span class="nt">&lt;xsl:sequence</span> <span class="na">select=</span><span class="s">"'https://xsltng.docbook.org/'"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line" db-line="32"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      <span class="nt">&lt;/xsl:when&gt;</span></code></span></span>
<span class="line" db-line="33"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      <span class="nt">&lt;xsl:when</span> <span class="na">test=</span><span class="s">"$name='Wikipedia'"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="34"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>        <span class="nt">&lt;xsl:sequence</span> <span class="na">select=</span><span class="s">"'https://wikipedia.org/'"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line" db-line="35"><span class="ln">35 <span class="nsep">|</span></span><span class="ld"><code>      <span class="nt">&lt;/xsl:when&gt;</span></code></span></span>
<span class="line" db-line="36"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      <span class="nt">&lt;xsl:otherwise&gt;</span></code></span></span>
<span class="line" db-line="37"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>        <span class="c">&lt;!-- Unrecognized --&gt;</span></code></span></span>
<span class="line" db-line="38"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      <span class="nt">&lt;/xsl:otherwise&gt;</span></code></span></span>
<span class="line" db-line="39"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="nt">&lt;/xsl:choose&gt;</span></code></span></span>
<span class="line" db-line="40"><span class="ln">40 <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;/xsl:variable&gt;</span></code></span></span>
<span class="line" db-line="41"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>                  </code></span></span>
<span class="line" db-line="42"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;xsl:choose&gt;</span></code></span></span>
<span class="line" db-line="43"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="nt">&lt;xsl:when</span> <span class="na">test=</span><span class="s">"empty($url)"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="44"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      <span class="nt">&lt;xsl:next-match/&gt;</span>  <a id="ex.next-match" class="callout-bug linecolumn" db-line="44" db-column="26">⑤</a></code></span></span>
<span class="line" db-line="45"><span class="ln">45 <span class="nsep">|</span></span><span class="ld"><code>    <span class="nt">&lt;/xsl:when&gt;</span></code></span></span>
<span class="line" db-line="46"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="nt">&lt;xsl:otherwise&gt;</span></code></span></span>
<span class="line" db-line="47"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{$url}"</span> <span class="na">title=</span><span class="s">"Home page"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="48"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>        <span class="nt">&lt;xsl:next-match/&gt;</span>  <a id="ex.next-match-48" class="callout-bug linecolumn" db-line="48" db-column="28">⑤</a></code></span></span>
<span class="line" db-line="49"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      <span class="nt">&lt;/a&gt;</span></code></span></span>
<span class="line" db-line="50"><span class="ln">50 <span class="nsep">|</span></span><span class="ld"><code>    <span class="nt">&lt;/xsl:otherwise&gt;</span></code></span></span>
<span class="line" db-line="51"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;/xsl:choose&gt;</span></code></span></span>
<span class="line" db-line="52"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;/xsl:template&gt;</span></code></span></span>
<span class="line" db-line="53"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="54"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;/xsl:stylesheet&gt;</span></code></span></span>
</pre></div></div><div class="calloutlist"><dl><dt class="callout"><a class="callout-bug" href="#ex.xmlns-m">①</a></dt><dd><p>All of the DocBook elements are processed in the “<a href="m_docbook.html"><code class="mode">m:docbook</code></a>” mode.</p></dd><dt class="callout"><a class="callout-bug" href="#ex.excl-m">②</a></dt><dd><p>Remember to exclude all the namespaces you declare so that they don’t wind up
scattered about in your HTML.</p></dd><dt class="callout"><a class="callout-bug" href="#ex.m-docbook">③</a></dt><dd><p>I repeat, all of the DocBook elements are processed in the
“<a href="m_docbook.html"><code class="mode">m:docbook</code></a>” mode. I expect failure to declare this mode is going to be a common
error.</p></dd><dt class="callout"><a class="callout-bug" href="#ex.cramped">④</a></dt><dd><p>Yes, this whole listing is rather cramped.
<span class="phrase">I’m trying to make it all narrow
enough to fit in the display without making horizontal scrolling necessary.</span>
</p></dd><dt class="callout"><a class="callout-bug" href="#ex.next-match">⑤</a></dt><dd><p>Calling <code class="literal">xsl:next-match</code> invokes the underlying
processing. The effect of this template is to wrap an HTML
“<code>a</code>” around the default processing for
<code class="tag tag-element">productname</code>.</p></dd></dl></div><p>It’s worth pointing out that if the tag has an
<code class="tag tag-attribute">xlink:href</code> attribute, that will generate an HTML
<code>a</code> as well. A more robust stylesheet would check for that,
but I’m trying to keep the example simple.</p></section><section id="managing-css" class="section"><header><h2><span class="label">3<span class="sep">.</span>3</span><span class="sep">. </span>Managing CSS stylesheets</h2></header><p>The HTML that the <i class="citetitle">DocBook xslTNG</i> stylesheet
produce is intended to be clean, robust markup for styling with CSS.
Exactly how you control which stylesheet links are produced has
changed several times. The current scheme is this:</p><ol class="orderedlist" type="1"><li><p>If syntax highlighting is enabled, a link to the
<a href="p_verbatim-syntax-highlight-css.html"><code class="paramname">$verbatim-syntax-highlight-css</code></a><span class="indexterm" id="managing-css_orderedlist1_listitem1_para1_indexterm1"></span> stylesheet is
included.
</p></li><li><p>If <a href="p_persistent-toc.html"><code class="paramname">$persistent-toc</code></a><span class="indexterm" id="managing-css_orderedlist1_listitem2_para1_indexterm1"></span> <span class="glossterm"><a href="glossary.html#glossary_ge5">is
true</a></span> 
a link to the <a href="p_persistent-toc-css.html"><code class="paramname">$persistent-toc-css</code></a><span class="indexterm" id="managing-css_orderedlist1_listitem2_para1_indexterm2"></span> stylesheet
is included.
</p></li><li><p>If <a href="p_use-docbook-css.html"><code class="paramname">$use-docbook-css</code></a><span class="indexterm" id="managing-css_orderedlist1_listitem3_para1_indexterm1"></span> <span class="glossterm"><a href="glossary.html#glossary_ge5">is true</a></span>,
links to the standard DocBook stylesheets are included. Those stylesheets
are <code class="filename">docbook.css</code> (for all media),
<code class="filename">docbook-screen.css</code> (for screen media), and
<code class="filename">docbook-page-setup.css</code> and
<code class="filename">docbook-paged.css</code> (for print media).
</p></li><li><p>The DocBook element that is the context element when the HTML
<code class="tag tag-element">head</code> is being
generated is processed in the <a href="m_html-head-links.html"><code class="mode">m:html-head-links</code></a> mode.
By default, that template does nothing, but you can change that in
a customization layer.</p></li><li><p>If any CSS stylesheets are defined in
<a href="p_user-css-links.html"><code class="paramname">$user-css-links</code></a><span class="indexterm" id="managing-css_orderedlist1_listitem5_para1_indexterm1"></span>, they are included.
</p></li><li><p>The DocBook element that is the context element when the HTML
<code class="tag tag-element">head</code> is being
generated is processed in the <a href="m_html-head-last.html"><code class="mode">m:html-head-last</code></a> mode.
By default, that template does nothing, but you can change that in
a customization layer.</p></li></ol></section><section id="different" class="section"><header><h2><span class="label">3<span class="sep">.</span>4</span><span class="sep">. </span>Creating something completely different</h2></header><p>Your input documents go through several pre-processing steps
before they are rendered into HTML. If you want to produce completely
different outputs, the place to start is with root template in the
<a href="m_docbook.html"><code class="mode">m:docbook</code></a> mode.</p><p>Consider, <a href="https://github.com/docbook/xslTNG/issues/84" class="link">for example</a>,
the task of creating a JSON version of the Table of Contents. In principle, you could
write your own stylesheet to do this, but leveraging the
<i class="citetitle">DocBook xslTNG Stylesheets</i> means you can make use of functions like
<a href="f_generate-id.html"><code class="funcname">f:generate-id()</code></a> to create links.</p><p>To produce completely different results, override the root template in the
<a href="m_docbook.html"><code class="mode">m:docbook</code></a> mode:</p><div class="pre-wrap highlight" db-startinglinenumber="1" db-numberoflines="5"><pre class="language-xml long numbered programlisting verbatim verblines"><span class="line" db-line="1"><span class="ln">1 <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;xsl:template</span> <span class="na">match=</span><span class="s">"/"</span> <span class="na">mode=</span><span class="s">"m:docbook"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="2"><span class="ln">  <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;xsl:document&gt;</span></code></span></span>
<span class="line" db-line="3"><span class="ln">  <span class="nsep">|</span></span><span class="ld"><code>    <span class="c">&lt;!-- your processing here --&gt;</span></code></span></span>
<span class="line" db-line="4"><span class="ln">  <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;/xsl:document&gt;</span></code></span></span>
<span class="line" db-line="5"><span class="ln">5 <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;/xsl:template&gt;</span></code></span></span>
</pre></div><p>This template <em>must</em> return a document node.</p><p>Note that you can mix-and-match your processing with default
processing by processing DocBook elements in the
<a href="m_docbook.html"><code class="mode">m:docbook</code></a> mode.</p><p>Here is a simple example of a stylesheet that produces a JSON version of the
Table of Contents for a DocBook document:</p><div class="pre-wrap highlight" db-startinglinenumber="1" db-numberoflines="53"><pre class="language-xml long numbered programlisting verbatim verblines"><span class="line" db-line="1"><span class="ln"> 1 <span class="nsep">|</span></span><span class="ld"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></code></span></span>
<span class="line" db-line="2"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;xsl:stylesheet</span> <span class="na">xmlns:xsl=</span><span class="s">"http://www.w3.org/1999/XSL/Transform"</span></code></span></span>
<span class="line" db-line="3"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>                <span class="na">xmlns:db=</span><span class="s">"http://docbook.org/ns/docbook"</span></code></span></span>
<span class="line" db-line="4"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>                <span class="na">xmlns:f=</span><span class="s">"http://docbook.org/ns/docbook/functions"</span></code></span></span>
<span class="line" db-line="5"><span class="ln"> 5 <span class="nsep">|</span></span><span class="ld"><code>                <span class="na">xmlns:m=</span><span class="s">"http://docbook.org/ns/docbook/modes"</span></code></span></span>
<span class="line" db-line="6"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>                <span class="na">xmlns:t=</span><span class="s">"http://docbook.org/ns/docbook/templates"</span></code></span></span>
<span class="line" db-line="7"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>                <span class="na">xmlns:xs=</span><span class="s">"http://www.w3.org/2001/XMLSchema"</span></code></span></span>
<span class="line" db-line="8"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>                <span class="na">xmlns=</span><span class="s">"http://www.w3.org/1999/xhtml"</span></code></span></span>
<span class="line" db-line="9"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>                <span class="na">exclude-result-prefixes=</span><span class="s">"db f m t xs"</span></code></span></span>
<span class="line" db-line="10"><span class="ln">10 <span class="nsep">|</span></span><span class="ld"><code>                <span class="na">version=</span><span class="s">"3.0"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="11"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="12"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>  <span class="c">&lt;!-- This href has to point to your local copy</span></code></span></span>
<span class="line" db-line="13"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="c">       of the stylesheets. --&gt;</span></code></span></span>
<span class="line" db-line="14"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;xsl:import</span> <span class="na">href=</span><span class="s">"docbook/xslt/docbook.xsl"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line" db-line="15"><span class="ln">15 <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="16"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;xsl:output</span> <span class="na">method=</span><span class="s">"text"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line" db-line="17"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="18"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>  <span class="c">&lt;!-- Suppress xslTNG's default HTML output; note that this template</span></code></span></span>
<span class="line" db-line="19"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="c">       must return a document node.  --&gt;</span></code></span></span>
<span class="line" db-line="20"><span class="ln">20 <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;xsl:template</span> <span class="na">match=</span><span class="s">"/"</span> <span class="na">mode=</span><span class="s">"m:docbook"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="21"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="nt">&lt;xsl:document&gt;</span></code></span></span>
<span class="line" db-line="22"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      <span class="nt">&lt;xsl:apply-templates</span> <span class="na">select=</span><span class="s">"."</span> <span class="na">mode=</span><span class="s">"TOC"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line" db-line="23"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="nt">&lt;/xsl:document&gt;</span></code></span></span>
<span class="line" db-line="24"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;/xsl:template&gt;</span></code></span></span>
<span class="line" db-line="25"><span class="ln">25 <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="26"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>  <span class="c">&lt;!-- The templates below generate a simple JSON ToC. --&gt;</span></code></span></span>
<span class="line" db-line="27"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="28"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;xsl:template</span> <span class="na">match=</span><span class="s">"/"</span> <span class="na">mode=</span><span class="s">"TOC"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="29"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    {"toc": [</code></span></span>
<span class="line" db-line="30"><span class="ln">30 <span class="nsep">|</span></span><span class="ld"><code>    <span class="nt">&lt;xsl:apply-templates</span> <span class="na">mode=</span><span class="s">"TOC"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line" db-line="31"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    ]}</code></span></span>
<span class="line" db-line="32"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;/xsl:template&gt;</span></code></span></span>
<span class="line" db-line="33"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="34"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;xsl:template</span> <span class="na">match=</span><span class="s">"db:part|db:article|db:section|db:chapter"</span> <span class="na">mode=</span><span class="s">"TOC"</span></code></span></span>
<span class="line" db-line="35"><span class="ln">35 <span class="nsep">|</span></span><span class="ld"><code>                <span class="na">expand-text=</span><span class="s">"yes"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="36"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="nt">&lt;xsl:if</span> <span class="na">test=</span><span class="s">"preceding-sibling::db:part</span></code></span></span>
<span class="line" db-line="37"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="s">                  | preceding-sibling::db:article</span></code></span></span>
<span class="line" db-line="38"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="s">                  | preceding-sibling::db:section</span></code></span></span>
<span class="line" db-line="39"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="s">                  | preceding-sibling::db:chapter"</span><span class="nt">&gt;</span>,<span class="ni">&amp;#10;</span><span class="nt">&lt;/xsl:if&gt;</span></code></span></span>
<span class="line" db-line="40"><span class="ln">40 <span class="nsep">|</span></span><span class="ld"><code>    {{</code></span></span>
<span class="line" db-line="41"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    "ref": "{f:generate-id(.)}",</code></span></span>
<span class="line" db-line="42"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    "title": "{normalize-space(db:info/db:title)}",</code></span></span>
<span class="line" db-line="43"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    "subtitle": "{normalize-space(db:info/db:subtitle)}",</code></span></span>
<span class="line" db-line="44"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    "items": [</code></span></span>
<span class="line" db-line="45"><span class="ln">45 <span class="nsep">|</span></span><span class="ld"><code>    <span class="nt">&lt;xsl:apply-templates</span> <span class="na">select=</span><span class="s">"db:part|db:article|db:section|db:chapter"</span> <span class="na">mode=</span><span class="s">"TOC"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line" db-line="46"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    ]</code></span></span>
<span class="line" db-line="47"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    }}</code></span></span>
<span class="line" db-line="48"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;/xsl:template&gt;</span></code></span></span>
<span class="line" db-line="49"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="50"><span class="ln">50 <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;xsl:template</span> <span class="na">match=</span><span class="s">"*"</span> <span class="na">mode=</span><span class="s">"TOC"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="51"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="nt">&lt;xsl:apply-templates</span> <span class="na">select=</span><span class="s">"*"</span> <span class="na">mode=</span><span class="s">"TOC"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line" db-line="52"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;/xsl:template&gt;</span></code></span></span>
<span class="line" db-line="53"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;/xsl:stylesheet&gt;</span></code></span></span>
</pre></div><div class="admonition note"><div><div class="icon">ⓘ</div><div class="body"><header><div class="title">Note</div></header><div><p>This example is meant as a starting point; it’s not robust as it only handles
a few of the possible elements that might appear in a Table of Contents.</p></div></div></div></div><p>When processing documents this way, be aware that you are transforming the pre-processed,
normalized versions of your input documents. For example, whether or not you put
<code class="tag tag-element">info</code> wrappers around the titles of your sections, in the pre-processed input,
<code class="tag tag-element">title</code>s <em>always</em> appear inside <code class="tag tag-element">info</code> wrappers.
This normalization greatly simplifies processing in many places.</p></section></div></main><footer><div class="footnotes"><hr/><div class="footnote" id="layer_para1_footnote1-fnote"><div class="footnote-number"><sup db-footnote="2" class="footnote-number"><a href="#layer_para1_footnote1-fref">*</a></sup></div><div class="footnote-body"><p>Ok,
technically, this stylesheet has a couple of namespace references that aren’t
strictly necessary so it could be a teeny bit simpler, but you’ll need those
declarations (and more!) if you want to do anything useful.</p></div></div></div></footer><nav class="bottom"><div class="navrow"><div class="navleft"><a title="Chapter  2 .  Using the stylesheets" href="ch-using.html"><i class="fas fa-arrow-left"></i></a></div><div class="navmiddle"><a title="" href="index.html"><i class="fas fa-home"></i></a></div><div class="navright"><a title="Chapter  4 .  Localization" href="ch-localization.html"><i class="fas fa-arrow-right"></i></a></div></div><div class="navrow"><div class="navleft navtitle">Chapter  2 .  Using the stylesheets</div><div class="navmiddle"><a title="Part  I .  Introduction" href="parti.html"><i class="fas fa-arrow-up"></i></a></div><div class="navright navtitle">Chapter  4 .  Localization</div></div><div class="infofooter"><span class="copyrightfooter"><a href="dbcpyright.html">Copyright</a> © 2020–2023 Norman Walsh.</span></div><nav class="tocopen"></nav><nav class="toc"></nav><!-- Hide ToC details from user agents that don’t support JS --><script type="text/html" class="tocopen"><i class="far fa-book"></i></script><script type="text/html" class="toc"><header><span>Table of Contents</span><span class="close"><i class="far fa-window-close"></i></span><p class="ptoc-search"><input class="ptoc-search" placeholder="Search" style="width: 80%"/></p></header><div db-persistent-toc="persistent-toc.html" db-prefix="">Loading…</div></script></nav><script src="./js/xlink.js"></script><script src="./js/persistent-toc.js"></script><script src="./js/chunk-nav.js"></script></body></html>